import os
import base64
import shutil
import datetime
extension = ".txt"
action = input("quelle action voulez-vous faire ? (1: chiffrer les fichiers, 2: dechiffrer les fichiers) ")
match action:
    case "1":
        repertoire = os.getcwd()
        contenus = os.listdir(repertoire)
        for contenu in contenus:
            if contenu.endswith(extension):
                shutil.copy(contenu, f'backup/{contenu}')
                print(f"chiffrement du fichier {contenu}")
                with open(contenu, "rb") as file:
                    data = file.read()
                enco_data = base64.b64encode(data)
                enco2_data = base64.b64encode(enco_data)
                with open(contenu, "wb") as file:
                    file.write(enco2_data)
                with open('chiffrement.log', 'a') as fichier:
                    now = datetime.datetime.now()
                    fichier.write(f"chiffrement du fichier {contenu} {now}\n")
    case "2":
        repertoire = os.getcwd()
        contenus = os.listdir(repertoire)
        for contenu in contenus:
            if contenu.endswith(extension):
                print(f"d√©chiffrement du fichier {contenu}")
                with open(contenu, "rb") as file:
                    data = file.read()
                deco_data = base64.b64decode(base64.b64decode(data))
                with open(contenu, "wb") as file:
                    file.write(deco_data)
                with open('dechiffrement.log', 'a') as fichier:
                    now = datetime.datetime.now()
                    fichier.write(f"dechiffrement du fichier {contenu} {now}\n")
    case action if action != "1" and action != "2":
        print("tapez 1 ou 2")
